---
title: Rate Limit 測試的思考筆記
date: 2025-12-11 21:30:00
tags:
  - Rate Limit 測試
  - 軟體測試
---

第一次在公司裡面測試 Rate Limit 的功能，這個機會不多，所以趁這個時機寫點紀錄
之前做過的壓力測試，主要都是為了量測系統是否能夠在某個 RPS/RPM(Request Per Second/Request Per Minute) 下正常運作
也會確保把機器打爆之後，將 RPS/RPM 歸零或設為小流量，確認機器是否能夠恢復正常
但是 Rate Limit 的測試就有一點點的不同，他是測試 Rate Limit 是否會被觸發，所以比較會是功能測試，但會需要用到壓力測試的工具
有些人的想法或許會比較單純的認為
「啊就把 RPS/RPM 直接壓爛，看有沒有回 429 就好啦~」
但實際上還是有蠻多的測試點可以做思考，所以寫出來記錄一下，畢竟這個機會也算是蠻難得的吧 🤩

先簡單描述一下這一次的 Rate Limit 功能

1. 未設定 RPS/RPM 的店家，都會走全域的 RPS/RPM
2. 可以針對店家設定屬於該店家的 RPS/RPM
3. 設定的地方在 Redis，所以預期改動設定會立即套用
4. 當觸發 RPS/RPM 時，會開始回應 429

## 針對功能進行測試的發想

### 測試前提

在發想前，為了避免過於發散，所以會先設一下 outline

1. 全域設定是必然存在的
2. 不需要「順便」測試系統負載，以 Rate Limit 的驗證為優先
3. 假設 Redis 連線正常，不測試 Redis 故障情況，聚焦在 Rate Limit 觸發邏輯本身

不過實務上還是會針對範圍以外的內容進行風險確認，畢竟 Redis 壞掉或者 Config 遺失的風險也還是可能存在的
就會確認這種狀態底下，是否會發生哪些問題(這個就會丟給開發者去做確認)

### 開始發想

先簡單暴力的確認全域的 RPS/RPM 可不可以正常運作，這樣做會引發一個思考
`如何確保被觸發的是 RPS 或 RPM?`
自我解答：就是把其中一個數字設定得很大，實際模擬 RPS/RPM 時，確保不會觸發到即可
但又冒出了一個問題
`我要如何在「不知道 RPS/RPM 是否正常運作」底下來假設「被觸發的 RPS/RPM 能夠正常運作」?`
再次自我解答：那就是先把兩個數字都設得很大，確保小流量不會回應 429，至少我能確認小流量的情況下系統正常運作了
確保 RPS/RPM 皆正常運作之後，再把其中一個數字設定為 1，這樣我手動就能觸發 429 確保 Rate Limit 機制正常運作了

所以這邊有幾個可變參數
1. 模擬的 RPS/RPM
2. 全域的 Config: RPS/RPM
3. 店家的 Config: RPS/RPM

透過操作可變餐數就可以展開一些待測的項目了

...